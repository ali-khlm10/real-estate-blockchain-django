{% extends "shared/_layout.html" %}

{% load render_partial %}


{% load static %}

{% block title %}صفحه درخواست های ارسالی{% endblock title %}

{% block content %}
{% csrf_token %}

<div id="buy_operation_modal" class="buy_modal">
    <div class="internal_buy_operation_modal">
        <button>x</button>
        <p>آیامایل به خرید ملک، با پرداخت هزینه موردنظر و هزینه تراکنش مربوطه هستید؟</p>
        
        <div>
            <label>شماره توکن ملک : </label>
            <span id="buy_operation_token_id">100000000</span>
        </div>
        <div>
            <label>مابقی هزینه پرداختی : </label>
            <span id="buy_operation_property_price">100000000</span>
        </div>
        <div>
            <label>هزینه انجام تراکنش : </label>
            <span id="buy_operation_transaction_fee">10000</span>
        </div>
        <section>
            <a id="do_buy_operation" href="#">انجام</a>
            <a id="dont_buy_operation" href="#">لغو</a>
        </section>             
    </div>
</div>

<div id="buy_operation_result_modal" class="buy_result_modal">
    <div class="internal_buy_operation_result_modal">
        <button>x</button>
        <p>عمل درخواست خرید ملک شما با موفقیت انجام شد.</p>
        <section>
            <a id="ok_buy_operation_result" href="#">فهمیدم</a>
        </section>             
    </div>
</div>

{% comment %} /////////////////////////////////////////////////////// {% endcomment %}


    <section class="dashboard_container">

            <section class="home_body_header">
                <header>
                    <h4>املاک و مستغلات/حساب کاربری</h4>
                </header>
            </section>

            <section class="main_dashbord">
                <div class="dashboard_body">
                    <header>
                        <h3>صفحه درخواست های ارسالی</h3>
                    </header>
                    <main class="dashboard_sended_requests">                     
                          
                        {% for buy_req, status,buy_id in zipped_list %}
                        <section>

                            <div>
                                <label for="">درخواست خرید به کاربر : </label>
                                <span>
                                    {{buy_req.buy_request_to}}
                                </span>
                            </div>

                            <div>
                                <label for="">  درخواست به شماره توکن : </label>
                                <span id="token_id_span">
                                    {{buy_req.token.token_id}}
                                </span>
                            </div>

                            <div>
                                <label for="">  مبلغ پیش پرداختی شما : </label>
                                <span>
                                    {{buy_req.buy_request_prepayment}}
                                    
                                </span>
                            </div>


                            <div>
                                <label for="">  زمان ارسال درخواست : </label>
                                <span>
                                    {{buy_req.buy_request_created_date}}
                                </span>
                            </div>

                            <div>
                                <label for=""> وضعیت درخواست : </label>
                                    {% for item in buy_req.request.all %}
                                        {% if item.pending %}
                                        <span style="color:yellow; font-weight:bold;font-family:'BYekan';"> در حال بررسی </span>
                                        {% elif item.is_accepted %}
                                        <span style="color:green; font-weight:bold;font-family:'BYekan';"> پذیرفته شده</span>
                                        {% else %}
                                        <span style="color:red; font-weight:bold;font-family:'BYekan';"> رد شده</span>

                                        {% endif %}
                                    {% endfor %}
                            </div>

                            {% for item in buy_req.request.all %}

                                {% if item.is_accepted %}

                                    {% if status == 'pending' %}
                                        <div id="buy_property_div">
                                            <hr>
                                            <span style="color:yellow; font-weight: bold; font-family:'Byekan'; padding:10px 0;">
                                            شما خرید ملک مورد نظر را نهایی کرده اید، لطفا منتظر پاسخ فروشنده بمانید.
                                            </span>
                                        </div>
                                    {%elif status == 'is_finalized' %}
                                        <div id="buy_property_div">
                                            <hr>
                                            <span style=" font-weight: bold; font-family:'Byekan'; padding:10px 0;">
                                                <a style="background-color:aquamarine;" href="{% url "buy-result" buy_id=buy_id %}">خرید ملک انجام شد، برای مشاهده نتیجه کلیک کنید.</a>
                                            </span>
                                        </div>
                                    {%else%}
                                        <div id="buy_property_div">
                                            <hr>
                                            <span>
                                                {% for accept_reject_item in buy_req.buy_request.all %}
                                                <a id="buy_operation" href="#" data-buy_request_prepayment="{{buy_req.buy_request_prepayment}}" data-token_id="{{buy_req.token.token_id}}" data-property_price="{{buy_req.token.property_of_token.property_detailes.property_price}}" data-accepted_buy_request="{{accept_reject_item.id}}"> نهایی کردن خرید ملک </a>
                                                
                                                {% endfor %}
                                            </span>
                                        </div>
                                    {% endif %}


                                {%endif%}

                            {%endfor%}


                            {% comment %} {% for item in buy_req.request.all %}

                                {% if item.is_accepted %}


                                    <div id="buy_property_div">
                                        <hr>
                                        <span>
                                            {% for item in buy_req.buy_request.all %}
                                            <a id="buy_operation" href="#" data-buy_request_prepayment="{{buy_req.buy_request_prepayment}}" data-token_id="{{buy_req.token.token_id}}" data-property_price="{{buy_req.token.property_of_token.property_detailes.property_price}}" data-accepted_buy_request="{{item.id}}"> خرید ملک </a>
                                            
                                            {% endfor %}
                                        </span>
                                    </div>

                                    {% for buy_request in buy_req.buy_request.all %}
                                        {% for accept_buy_request in buy_request.accept_reject_buy_request.all %}
                                            {% for buy_status in accept_buy_request.finalized_buy.all %}

                                                {% if buy_status.pending %}
                                                    <div id="buy_property_div">
                                                        <hr>
                                                        <span style="color:yellow; font-weight: bold; font-family:'Byekan'; padding:10px 0;">
                                                        شما خرید ملک مورد نظر را نهایی کرده اید.
                                                        </span>
                                                    </div>
                                                {% elif buy_status.is_finalized %}
                                                    <div id="buy_property_div">
                                                        <hr>
                                                        <span style="color:bluesky; font-weight: bold; font-family:'Byekan'; padding:10px 0;">
                                                            <a href="#">خرید ملک انجام شد، برای مشاهده نتیجه کلیک کنید.</a>
                                                        </span>
                                                    </div>
                                                {% endif %}
                                                        
                                            {% endfor %}
                                        {% endfor %}
                                
                                    {% endfor %}


                                {% endif %}
                            {% endfor %} {% endcomment %}

                        </section>
                        {% endfor %} 

                    </main>
                </div>
                {% render_partial 'user_panel_module.views.user_panel_menu_component' %}
                
            </section>

    </section>

{% endblock content %}